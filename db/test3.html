<!doctype html>
<html>
<head>
	<meta charset="utf8">
	<title>SQL TEST 3</title>
	<script src="./sql.js"></script>
</head>

<body>
	
	<button id='submit'>Execute</button>
	<pre id='result'></pre>
	<pre id='error'></pre>
	<pre id="output">Results will be displayed here</pre>
	LISTADO 1
	<ul id ="listado"></ul>
	LISTADO 2
	<ul id ="listado2"></ul>
	LISTADO 3
	<ul id ="listado3"></ul>	
	<script>
		
document.getElementById('submit').onclick = function () {
				
    function initDatabase(success) {
		var path = './siguaLite.db';
        var f = new XMLHttpRequest();
        f.open("GET", path, true); 
        f.responseType = "arraybuffer";
        f.onload = function() {
            var data = new Uint8Array(f.response);
            var arr = new Array();
            for(var i = 0; i != data.length; ++i) arr[i] = String.fromCharCode(data[i]);
            success(arr.join(""));
        };
        f.send();
    };

		var path = './siguaLite.db';		
		var xhr = new XMLHttpRequest();
		// For example: https://github.com/lerocha/chinook-database/raw/master/ChinookDatabase/DataSources/Chinook_Sqlite.sqlite
		xhr.open('GET', path, true);
		xhr.responseType = 'arraybuffer';

		xhr.onload = e => {
		  var uInt8Array = new Uint8Array(this.response);
		  var db = new SQL.Database(uInt8Array);
		  var contents = db.exec("SELECT * FROM actividades;");
		  console.log(contents);
		  // contents is now [{columns:['col1','col2',...], values:[[first row], [second row], ...]}]
		};
		xhr.send();		


    
    //console.log('Here is a row: ' + JSON.stringify( initDb() ) );
    


  initDatabase( function(data)  {
	  // query 1
	  var sql ="SELECT * FROM actividades WHERE codactividad BETWEEN $start AND $end";  
	  var db = new SQL.Database(data);  
      var results = db.prepare(sql);
      results.getAsObject({$start:1, $end:1}); // {col1:1, col2:111}
  
      // Bind new values
      results.bind({$start:1, $end:20});
      $('#listado').empty();
	  var unaLista = "";
      while(results.step()) { //
        var row = results.getAsObject();
        unaLista += "<li>"+row.txt_actividad+"</li>";
      }
      $('#listado').append(unaLista);
      
      
 	  // query 2
	  var sql ="SELECT * FROM personal WHERE cod_depto like $var";  
	  var db = new SQL.Database(data);  
      var results = db.prepare(sql);
      // Bind new values
      //results.bind({':var':'B103'});
      results.bind({$var:'B103'});
      
      $('#listado2').empty();
	  var unaLista = "";
      while(results.step()) { //
        var row = results.getAsObject();
        unaLista += "<li>"+row.nombre+"</li>";
      }
      $('#listado2').append(unaLista);     
      


 	  // query 3
	  var sql ="SELECT * FROM personal WHERE nombre like $var1 and cod_depto like $var2";  
	  var db = new SQL.Database(data);  
      var results = db.prepare(sql);
      // Bind new values
      results.bind({$var1:'JOSE%',$var2:'CARGO'});
      
      $('#listado3').empty();
	  var unaLista = "";
      while(results.step()) { //
        var row = results.getAsObject();
        unaLista += "<li>"+row.nombre+" - "+ row.cod_depto + "</li>";
      }
      $('#listado3').append(unaLista);       
      
	  
  });		  





 	
};
		




	</script>
	<script src='deps/jquery-3.3.1.min.js'></script>
</body>
